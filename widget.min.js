(function(){"use strict";const e={IFRAME_URL:"http://localhost:5173"};let t=!1,n=null;function o(){n||((n=document.createElement("iframe")).id="user-widget-iframe",n.src=e.IFRAME_URL,n.style.cssText="position:fixed;bottom:20px;right:20px;width:360px;height:640px;border:none;border-radius:16px;z-index:999999;overflow:visible;background:transparent;transition:all 0.3s ease;color-scheme:light dark;",n.title="User Widget",n.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups allow-top-navigation-by-user-activation"),document.body.appendChild(n))}function s(e){if(n&&n.contentWindow)try{n.contentWindow.postMessage(e,"*"),console.log("📤 Mensagem enviada:",e.type)}catch(t){console.warn("Erro ao enviar mensagem:",t)}}function a(){t?n&&(t=!1,s({type:"HIDE_WIDGET"}),console.log("Widget fechado")):(o(),t=!0,s({type:"SHOW_WIDGET"}),console.log("Widget aberto"))}function i(e){switch(e.data.type){case"READY":s({type:"USER_DATA",userId:window.loggedUserId,isWidgetOpen:t});break;case"CLOSE_WIDGET":t=!1,s({type:"HIDE_WIDGET"});break;case"OPEN_WIDGET":t=!0,s({type:"SHOW_WIDGET"});break;case"REQUEST_USER_DATA":s({type:"USER_DATA",userId:window.loggedUserId,isWidgetOpen:t});break;default:console.log("📥 Mensagem recebida:",e.data.type)}}!function(){if(window._userWidgetInitialized)return void console.warn("Widget já foi inicializado");if("loading"===document.readyState)return void document.addEventListener("DOMContentLoaded",arguments.callee);console.log("🚀 Inicializando User Widget..."),window.addEventListener("message",i),o(),window._userWidgetInitialized=!0,window.loggedUserId?console.log("✅ loggedUserId:",window.loggedUserId):console.warn("⚠️ loggedUserId não encontrado")}(),window.UserWidget={open:function(){o(),t=!0,s({type:"SHOW_WIDGET"}),console.log("Widget aberto")},close:function(){n&&(t=!1,s({type:"HIDE_WIDGET"}),console.log("Widget fechado"))},toggle:a,isOpen:()=>t,sendMessage:s}})();
